(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1128:function(e,t,n){"use strict";n.r(t);var i=n(1),s=n(0),r=n(10),a=n(15),o=n(200),p=n(69),d=n(382),c=n(65),u=n(269),l=n(375),h=n(914),b=n(270),g=n(35),S=n(123),f=n(36),y=n(92),m=n(55),v=n(46),k=n(77),C=function(){function e(e,t){this.http=e,this.permissionService=t,this.BASE_URL="/tdstm/ws/asset"}return e.prototype.getDependencies=function(e){var t=this.BASE_URL+"/listDependencies",n=e.page,i=e.take,s=e.sort,r=e.filters,a={rows:i,page:n,sidx:s.field,sord:s.dir};return r.reduce(function(e,t){return e[t.field]=t.value,e},a),this.http.post(t,JSON.stringify(a)).pipe(Object(S.map)(function(e){var t=e.json(),n=t&&t.data||{},i=n.dependencies,s=void 0===i?[]:i,r=n.total;return{data:s,total:void 0===r?0:r}}))},e=i.b([Object(s.B)(),i.d("design:paramtypes",[v.a,k.a])],e)}(),E=function(){return function(){this.columns=[{label:"Asset",property:"assetName",type:"text",width:160,locked:!0},{label:"Asset Type",property:"assetType",type:"text",width:120,locked:!0},{label:"Bundle",property:"assetBundle",type:"text",width:120},{label:"Tags Asset",property:"tagsAsset",type:"tags",width:220,locked:!1},{label:"Type",property:"type",type:"text",width:120},{label:"Depends On",property:"dependentName",type:"text",width:160},{label:"Dep Asset Type",property:"dependentType",type:"text",width:140},{label:"Dep Asset Bundle",property:"dependentBundle",type:"text",width:140},{label:"Dep Asset Tags",property:"tagsDependent",type:"tags",width:220,locked:!1},{label:"Status",property:"status",type:"text",width:100},{label:"Comment",property:"comment",type:"text",width:150},{label:"Frequency",property:"frequency",type:"text",width:120},{label:"Direction",property:"direction",type:"text",width:100},{label:"C1",property:"c1",type:"text",width:100},{label:"C2",property:"c2",type:"text",width:100},{label:"C3",property:"c3",type:"text",width:100},{label:"C4",property:"c4",type:"text",width:100}]}}(),D=n(28),O=n(378),I=n(59),j=n(60),A=n(306),w=n(38),x=n(906),N=n(916),T=n(918),B=function(){function e(e,t){this.dialog=e,this.dependencyService=t}return e.prototype.getOpenAssetsHandler=function(e){var t=this;return function(n,i){var s=t.getAssetForOpen(e,n,i);return s.getParams.pipe(Object(S.switchMap)(function(e){return g.Observable.from(s.open.apply(s,[s.component,e].concat(s.extraParams)))}))}},e.prototype.getAssetForOpen=function(e,t,n){var i,s=e[0],r=e[1],a=e[2],o=this.dialog.open.bind(this.dialog),p=this.dialog.extra.bind(this.dialog);return((i={})[s]={component:N.a,getParams:g.Observable.of([{provide:"ID",useValue:n.id},{provide:"ASSET",useValue:n.class}]),extraParams:[D.e.LG],open:o},i[r]={component:N.a,getParams:g.Observable.of([{provide:"ID",useValue:n.dependentId},{provide:"ASSET",useValue:n.dependentClass}]),extraParams:[D.e.LG],open:o},i[a]={component:T.a,getParams:this.dependencyService.getDependencies(n.id,n.dependentId).pipe(Object(S.switchMap)(function(e){return g.Observable.of([{provide:"ASSET_DEP_MODEL",useValue:e}])})),extraParams:[!0],open:p},i)[t]||null},e=i.b([Object(s.B)(),i.d("design:paramtypes",[w.b,x.a])],e)}(),P=function(){function e(e,t,n,i,s,r,a,o,p){this.route=e,this.changeDetectorRef=t,this.dialog=n,this.notifier=i,this.bulkCheckboxService=s,this.dependenciesService=r,this.openAssetDependenciesService=a,this.translatePipe=o,this.assetService=p,this.bulkChangeType=I.c.Dependencies,this.GRID_PAGE_SIZES=D.m,this.defaultSorting={dir:"asc",field:"assetName"},this.tagsFieldNames=[],this.actionableAssets=["assetName","dependentName","type"],this.openAssetsHandler=null}return e.prototype.ngOnInit=function(){this.state=this.getInitialComponentState(),this.openAssetsHandler=this.openAssetDependenciesService.getOpenAssetsHandler(this.actionableAssets),this.destroySubject=new g.Subject,this.componentState=new g.BehaviorSubject(this.state),this.tagsStateSubject=new g.Subject,this.setupGridColumns(),this.setupBulkCheckboxService(),this.setupComponentStateObservable(),this.setupTagsFilterStateObservable()},e.prototype.ngOnDestroy=function(){this.destroySubject.next()},e.prototype.setupBulkCheckboxService=function(){this.bulkCheckboxService.setCurrentState(j.a.unchecked),this.bulkCheckboxService.setIdFieldName("id")},e.prototype.setupComponentStateObservable=function(){var e=this;this.componentState.pipe(Object(S.takeUntil)(this.destroySubject),Object(S.scan)(function(e,t){return i.a({},e,t)},{}),Object(S.mergeMap)(function(t){return e.getDataFromEndpoint()(t).pipe(Object(S.map)(function(e){return i.a({},t,{gridData:e})}))})).subscribe(function(t){e.state=t,e.updateGridState(t.gridState),e.notifyChangedState(t.gridData.data),e.changeDetectorRef.detectChanges()},this.logError("setupComponentStateObservable"))},e.prototype.changeState=function(e){void 0===e&&(e={}),this.componentState.next(e)},e.prototype.getInitialComponentState=function(){return{tagList:Object(f.m)([],["snapshot","data","tagList"],this.route),gridState:this.getInitialGridState(),gridData:{data:[],total:0}}},e.prototype.setupTagsFilterStateObservable=function(){var e=this;this.tagsStateSubject.pipe(Object(S.takeUntil)(this.destroySubject),Object(S.withLatestFrom)(this.componentState),Object(S.map)(function(t){var n=t[0],i=t[1];return e.mergeTagsFilterIntoGridState(n,i)})).subscribe(function(t){e.changeState(t)},this.logError("setupTagsFilterStateObservable"))},e.prototype.getInitialGridState=function(){return{sort:[this.defaultSorting],filter:{filters:[],logic:"and"},take:D.l,skip:0}},e.prototype.getDataFromEndpoint=function(){var e=this.dependenciesService.getDependencies.bind(this.dependenciesService);return Object(f.b)(e,this.getParametersForEndpoint.bind(this))},e.prototype.getParametersForEndpoint=function(e){var t=e.gridState,n=t.skip,i=t.take,s=t.sort,r=t.filter;return{page:n/i+1,take:i,filters:r&&r.filters||[],sort:s&&s[0]||this.defaultSorting}},e.prototype.updateGridState=function(e){var t=e.sort,n=e.filter,i=e.skip,s=e.take;this.grid.sort=t,this.grid.filter=n,this.grid.skip=i,this.grid.pageSize=s,this.bulkCheckboxService.setPageSize(s)},e.prototype.dataStateChange=function(e){this.changeState({gridState:e})},e.prototype.onTagFilterChange=function(e,t){var n=t.operator&&"ALL"===t.operator?"&":"|",i=(t.tags||[]).filter(function(e){return!isNaN(e.id)}).map(function(e){return e.id}).join(n);this.tagsStateSubject.next({field:e,tags:i})},e.prototype.getSelectedItemsCount=function(){var e=this.bulkCheckboxService.getSelectedItemsCount(this.state.gridData.total),t={count:e,entityName:1===e?this.translatePipe.transform("DEPENDENCIES.SINGLE_NAME"):this.translatePipe.transform("DEPENDENCIES.PLURAL_NAME")};return e>0?t:null},e.prototype.onBulkOperationResult=function(e){e.success&&(this.bulkCheckboxService.uncheckItems(),this.changeState())},e.prototype.getCurrentBulkSelectedItems=function(){var e=this.dependenciesService.getDependencies.bind(this.dependenciesService),t=i.a({},this.state.gridState,{skip:0,take:this.state.gridData.total}),n=i.a({},this.state,{gridState:t});return this.bulkCheckboxService.getBulkSelectedItems(this.getParametersForEndpoint(n),e).pipe(Object(S.takeUntil)(this.destroySubject),Object(S.map)(function(e){return{bulkItems:e.selectedAssetsIds.slice(),assetsSelectedForBulk:e.selectedAssets.slice()}}))},e.prototype.onClickBulkButton=function(){var e=this;this.getCurrentBulkSelectedItems().subscribe(function(t){return e.tdsBulkChangeButton.bulkData(t)},this.logError("onClickBulkButton"))},e.prototype.mergeTagsFilterIntoGridState=function(e,t){var n=Object(f.m)([],["gridState","filter","filters"],t).filter(function(t){return t.field!==e.field});e.tags&&n.push({field:e.field,value:e.tags,operator:null});var i=Object(f.a)(t);return i.gridState.filter.filters=n,i},e.prototype.logError=function(e){return function(t){return console.error("Error, function:"+e+" message:"+(t.message||t))}},e.prototype.setupGridColumns=function(){this.dependenciesColumnModel=new E,this.tagsFieldNames=this.dependenciesColumnModel.columns.reduce(function(e,t){return"tags"===t.type?e.concat([t.property]):e},[])},e.prototype.notifyChangedState=function(e){this.bulkCheckboxService.initializeKeysBulkItems(e),this.notifier.broadcast({name:"grid.header.position.change"}),jQuery(".k-grid-content-locked").addClass("element-height-100-per-i")},e.prototype.onClickActionableColumn=function(e){var t=this,n=e.column.field;if(this.actionableAssets.includes(n)){var i={id:e.dataItem.assetId,class:e.dataItem.assetClass,dependentId:e.dataItem.dependentId,dependentClass:e.dataItem.dependentClass};this.openAssetsHandler(n,i).pipe(Object(S.takeUntil)(this.destroySubject)).subscribe(function(e){return t.changeState()},function(e){console.log(e),t.changeState()})}},i.b([Object(s.lb)("tdsBulkChangeButton"),i.d("design:type",A.a)],e.prototype,"tdsBulkChangeButton",void 0),i.b([Object(s.lb)("grid"),i.d("design:type",y.a)],e.prototype,"grid",void 0),e=i.b([Object(s.n)({selector:"tds-dependencies-view-grid",templateUrl:"../tds/web-app/app-js/modules/dependencies/components/view-grid/dependencies-view-grid.component.html",changeDetection:s.j.OnPush}),i.d("design:paramtypes",[c.a,s.k,w.b,m.a,O.a,C,B,p.a,x.a])],e)}(),L=function(){function e(){}return e.DEPENDENCIES_LIST={url:"list"},e}(),F=[{path:"",pathMatch:"full",redirectTo:L.DEPENDENCIES_LIST.url},{path:L.DEPENDENCIES_LIST.url,data:{page:{title:"DEPENDENCIES.LIST_TITLE",instruction:"",menu:["ASSETS.ASSETS","DEPENDENCIES.MENU_TITLE"],topMenu:{parent:"menu-parent-assets",child:"menu-parent-assets-dependencies-list",subMenu:!0}},requiresAuth:!0},component:P,canActivate:[b.a,u.a,l.a],resolve:{tagList:h.a},runGuardsAndResolvers:"always"}],G=function(){function e(){}return e=i.b([Object(s.J)({exports:[c.d],imports:[c.d.forChild(F)]})],e)}(),M=n(1129),_=n(1114),U=n(1111),R=n(1116),H=n(1132),J=n(1133),V=n(1115),q=n(373);n.d(t,"DependenciesModule",function(){return z});var z=function(){function e(){}return e=i.b([Object(s.J)({imports:[r.b,o.a,d.AssetExplorerModule,a.c,M.a,_.a,U.a,H.a,J.a,R.a,V.a,G],declarations:[P],providers:[h.a,u.a,C,B,q.a,p.a],exports:[P],entryComponents:[]})],e)}()}}]);