<tds-ui-floating-header-k-grid></tds-ui-floating-header-k-grid>

<kendo-grid
	*ngIf="getDynamicConfiguration(); let config"
		class="tds-kendo-grid without-selectabe-rows asset-explorer-view-grid-component"
		[filterable]="true"
		[sortable]="{ mode:'single' }"
		[data]="gridData"
		[skip]="gridState.skip"
		[sort]="gridState.sort"
		[pageSize]="gridState.take"
		[resizable]="true"
		[pageable]="{ pageSizes: maxOptions, info: true}"
		(dataStateChange)="dataStateChange($event)"
		(columnResize)="onWidthChange($event)"
		(cellClick)="cellClick($event)"
		[rowClass]="rowCallbackClass">

		<!-- Header Toolbar -->
		<ng-template kendoGridToolbarTemplate [position]="'top'" class="header-section">
			<div class="col-sm-6 bulkchange-section">
				<div class="btn-group btn-between-space-5">

					<button type="button" [disabled]="!config.canCreateAssets"
					        [attr.data-toggle]="!isMainView(_viewId) ? 'dropdown' : ''"
					        class="btn btn-default dropdown-toggle tds-button-toolbar"
					        (click)="_viewId !== ASSET_ENTITY_MENU.All_ASSETS && onCreateAsset(createButtonState)">
						{{ 'GLOBAL.CREATE' | translate }}
					</button>

					<button type="button" class="btn btn-default dropdown-toggle tds-button-toolbar" [disabled]="!config.canCreateAssets"
					        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						<span class="caret"></span>
						<span class="sr-only">Toggle Dropdown</span>
					</button>
					<ul class="dropdown-menu">
						<li (click)="onCreateAsset(ASSET_ENTITY_DIALOG_TYPES.APPLICATION)">
							<a [ngClass]="{'create-selected': createButtonState === ASSET_ENTITY_DIALOG_TYPES.APPLICATION}">{{ 'ASSETS.APPLICATION' | translate }}</a>
						</li>
						<li (click)="onCreateAsset(ASSET_ENTITY_DIALOG_TYPES.DATABASE); setCreatebuttonState(ASSET_ENTITY_DIALOG_TYPES.DATABASE)">
							<a [ngClass]="{'create-selected': createButtonState === ASSET_ENTITY_DIALOG_TYPES.DATABASE}">{{ 'ASSETS.DATABASE' | translate }}</a>
						</li>
						<li (click)="onCreateAsset(ASSET_ENTITY_DIALOG_TYPES.DEVICE); setCreatebuttonState(ASSET_ENTITY_DIALOG_TYPES.DEVICE)">
							<a [ngClass]="{'create-selected': createButtonState === ASSET_ENTITY_DIALOG_TYPES.DEVICE}">{{ 'ASSETS.DEVICE' | translate }}</a>
						</li>
						<li (click)="onCreateAsset(ASSET_ENTITY_DIALOG_TYPES.STORAGE); setCreatebuttonState(ASSET_ENTITY_DIALOG_TYPES.STORAGE)">
							<a [ngClass]="{'create-selected': createButtonState === ASSET_ENTITY_DIALOG_TYPES.STORAGE}">{{ 'ASSETS.STORAGE' | translate }}</a>
						</li>
					</ul>
				</div>
				<tds-bulk-change-button #tdsBulkChangeButton
				                        [enabled]="config.hasSelectedItems"
				                        [showDelete]="true"
				                        [showEdit]="true"
				                        [bulkChangeType]="bulkChangeType"
										[viewId]="_viewId"
				                        (clickBulk)="onClickBulkButton()"
				                        (operationResult)="onBulkOperationResult($event)"></tds-bulk-change-button>
				<div *ngIf="config.hasSelectedItems && config.getSelectedItemsCount; let counter" class="bulk-change-counter">
					<span class="badge badge-light">{{counter}}</span><label>{{ (counter === 1 ? 'ASSETS.SINGLE_NAME' : 'ASSETS.PLURAL_NAME') | translate }} selected</label>
				</div>
				<div class="checkbox just-planning">
					<input id="justPlanning" type="checkbox" (change)="onChangeJustPlanning($event.currentTarget.checked)"
					       [(ngModel)]="justPlanning" name="justPlanning" class="component-action-just-planning">
					<label style="margin-left: 4px;" for="justPlanning">Just Planning</label>
				</div>
			</div>
			<div class="col-sm-6 filters-section">
				<div *ngIf="hiddenFilters; then hiddenFiltersButton else clearFilters"></div>
				<ng-template #clearFilters>
					<tds-button-custom
							class="component-action-clear-filters"
							id="btnClean"
							icon="times"
							title="Clear filters"
							[disabled]="!config.hasFilterApplied"
							(click)="onClearFilters()">
					</tds-button-custom>
				</ng-template>
				<ng-template #hiddenFiltersButton>
					<tds-button-custom
							class="component-action-clear-filters"
							id="btnCleanHiddenFilters"
							icon="eye-close"
							title="Clear filters"
							tooltip="Clear filters and Hidden Fields"
							iconPrefixVendor="glyphicon glyphicon-"
							[disabled]="!config.hasFilterApplied"
							(click)="onClearHiddenFilters()">
					</tds-button-custom>
				</ng-template>
				<tds-button-custom
					icon="refresh"
					title="Refresh"
					isIconButton="true"
					class="component-action-reload pull-righ"
					(click)="onReloadClick()">
				</tds-button-custom>
			</div>
		</ng-template>

		<!-- Select All column -->
		<kendo-grid-column title=""
                           [locked]="model && model.columns && model.columns.length > 0" *ngIf="model && model.columns && model.columns.length > 0"
                           [width]="SELECT_ALL_COLUMN_WIDTH"
                           [filterable]="false">
			<ng-template kendoGridHeaderTemplate>
				<div class="row text-center">
                    <tds-checkbox name="assetsSelector"
								  [hasThirdState]="true"
								  [disabled]="!isBulkSelectAvailable()"
                                  (changeState)="onChangeBulkCheckbox($event)"
                                  id="assetSelector"
                                  [setStateSubject]="bulkCheckboxService.setStateSubject"></tds-checkbox>
				</div>
			</ng-template>

			<ng-template kendoGridCellTemplate let-dataItem>
				<label class="selectall-checkbox-column text-center">
					<input type="checkbox" id="checkbox_{{dataItem.common_id}}" 
					[ngStyle]="{'cursor': isBulkSelectAvailable() ? 'pointer' : 'text' }"
					[disabled]="!isBulkSelectAvailable()"
					[checked]="bulkCheckboxService.getValueBulkItem(dataItem.common_id)" 
					(change)="checkItem(dataItem.common_id, $event.target.checked)" 
					name="checkbox_{{dataItem.common_id}}">
				</label>
			</ng-template>
		</kendo-grid-column>

		<!-- Action -->
		<kendo-grid-command-column [width]="75" [class]="{'k-custom-command-column': true}" [minResizableWidth]="75" [locked]="true"
								   *ngIf="model && model.columns && model.columns.length > 0">
			<ng-template kendoGridHeaderTemplate>
				<div class="text-center">
					<label class="action-header"> {{ 'GLOBAL.ACTION' | translate }} </label>
				</div>
			</ng-template>
			<ng-template kendoGridCellTemplate
			             let-dataItem
			             let-rowIndex="rowIndex"
			             let-isComment="dataItem.taskAndCommentFlags.comment"
			             let-isIssue="dataItem.taskAndCommentFlags.issue">
				<div class="tds-action-button-set">
					<tds-button-edit  
						(click)="showAssetEditView(dataItem, rowIndex)" 
						tooltip="Edit Asset"
						[disabled]="!isEditAvailable()">
					</tds-button-edit>
					<tds-button-custom 
						tooltip="Create Task" 
						icon="file-text-o" 
						*ngIf="!isIssue" 
						[disabled]="!isTaskCreateAvailable()"
						(click)="createTask(dataItem, rowIndex)"
						>
					</tds-button-custom>
					<tds-button-custom 
						tooltip="List Tasks" 
						icon="list-alt" 
						*ngIf="isIssue" 
						(click)="showTask(dataItem, rowIndex)">
					</tds-button-custom>
					<tds-button-custom 
						tooltip="Create Comment" 
						icon="comment-o" 
						*ngIf="!isComment" 
						[disabled]="!isCommentCreateAvailable()"
						(click)="createComment(dataItem, rowIndex)">
					</tds-button-custom>
					<tds-button-custom 
						tooltip="Show Comments" 
						icon="comments-o" 
						*ngIf="isComment" 
						(click)="showComment(dataItem, rowIndex)">
					</tds-button-custom>
					<tds-button-clone  
						(click)="showAssetCloneView(dataItem, rowIndex)"
						[disabled]="!isAssetCloneAvailable()">
					</tds-button-clone>
				</div>
			</ng-template>
		</kendo-grid-command-column>

		<!-- Configured View Columns (*ngFor) -->
		<kendo-grid-column
				*ngFor="let column of model.columns; let i = index"
				[locked]="column.locked"
				field="{{column.domain}}_{{column.property}}"
				[minResizableWidth]="VIEW_COLUMN_MIN_WIDTH_SHRINK"
				[width]="commonShrunkColumns.includes(column.label)? commonShrunkColumnWidth : column.width"
				[class]="column.domain"
		>
			<ng-template kendoGridHeaderTemplate>
				<div class="sortable-column component-action-sort" (click)="onClickTemplate($event)">
					<div [ngClass]="{'field-not-found': column?.notFound }">
						<label> {{getPropertyLabel(column)}} <i class="fa fa-fw fa-warning" style="display: none;" attr.data-content="{{ 'FIELD_SETTINGS.FIELD_NO_LONGER_EXISTS_ON_DOMAIN' | translate}} {{column.domain}} ({{column.property}})" data-toggle="popover" data-trigger="hover"></i> </label>
					</div>
				</div>
				<i *ngIf="column.property === 'tagAssets'"
				   class="fa"
				   [ngClass]="showFullTags ? 'fa-angle-double-down' : 'fa-angle-double-right'"
				   style="margin-top: 3px;"
				   (click)="onToggleTagsView($event)" title="Toggle Tags View"></i>
			</ng-template>

			<!-- Default Generic Filter Template -->
			<ng-template kendoGridFilterCellTemplate *ngIf="column.property !== 'tagAssets'">
				<div class="has-feedback  asset-grid-margin">
					<tds-filter-input
						name="{{column.domain}}.{{column.property}}"
						[value]="column.filter"
						placeholder="{{'GLOBAL.FILTER' | translate}}"
						(filter)="setFilter($event, column)">
					</tds-filter-input>
				</div>
			</ng-template>
			<!-- Asset Tags Filter Template -->
			<ng-template kendoGridFilterCellTemplate *ngIf="column.property === 'tagAssets'">
				<tds-asset-tag-selector #tagSelector
										[tagList]="metadata.tagList"
										placeholder="{{'GLOBAL.FILTER' | translate}}"
				                        [viewFilterModel]="column.filter"
				                        (valueChange)="onTagFilterChange(column, $event)">
				</tds-asset-tag-selector>
			</ng-template>

			<!-- Default Generic Cell Template -->
			<ng-template kendoGridCellTemplate let-dataItem *ngIf="column.property !== 'tagAssets' && !fieldPipeMap.pipe[column.domain+'_'+column.property]">
               <span [ngClass]="getCellClass(column)">
                   {{fieldPipeMap[column.domain+'_'+column.property]}}
				   {{dataItem[column.domain+'_'+column.property]}}
               </span>
			</ng-template>
            <!-- DateTime Fields Template -->
            <ng-template kendoGridCellTemplate let-dataItem *ngIf="fieldPipeMap.pipe[column.domain+'_'+column.property] === 'DateTime'">
                <div>
					{{dataItem[column.domain+'_'+column.property]| tdsDateTime : userTimeZone }}
                </div>
            </ng-template>
            <!-- Date Fields Template -->
            <ng-template kendoGridCellTemplate let-dataItem *ngIf="fieldPipeMap.pipe[column.domain+'_'+column.property] === 'Date'">
                <div>
					{{dataItem[column.domain+'_'+column.property]| tdsDate : userDateFormat }}
                </div>
            </ng-template>
            <!-- Number Fields Template -->
            <ng-template kendoGridCellTemplate let-dataItem *ngIf="fieldPipeMap.pipe[column.domain+'_'+column.property] === 'Number'">
                <div>
					{{dataItem[column.domain+'_'+column.property]| tdsNumber : fieldPipeMap.metadata[column.domain+'_'+column.property] }}
                </div>
            </ng-template>
			<!-- Asset Tags Cell Template -->
			<ng-template kendoGridCellTemplate let-dataItem *ngIf="column.property === 'tagAssets'">
				<div class="single-line-tags"
					 (mouseleave)="refreshTableSize($event)"
					 [ngClass]="showFullTags ? 'show-full-tags': ''">
					<ng-template ngFor let-tag [ngForOf]="dataItem[column.domain+'_'+column.property]" let-i="index">
						<span class="label tag" [ngClass]="tag.css">{{tag.name}}</span>
					</ng-template>
				</div>
			</ng-template>
		</kendo-grid-column>

		<!-- No Records -->
		<ng-template kendoGridNoRecordsTemplate>
		</ng-template>

		<!-- Pagination Footer -->
		<ng-template kendoPagerTemplate let-totalPages="totalPages" let-pageSize="pageSize" let-currentPage="currentPage">
			<kendo-pager-prev-buttons></kendo-pager-prev-buttons>
			<kendo-pager-next-buttons></kendo-pager-next-buttons>
			<kendo-pager-page-sizes [pageSizes]="maxOptions"></kendo-pager-page-sizes>
			<div *ngIf="showMessage" class="grid-message">
				<label>{{ gridMessage | translate }}</label>
			</div>
			<kendo-pager-info></kendo-pager-info>
		</ng-template>
	</kendo-grid>

