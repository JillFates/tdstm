<div class="content body tds-kendo-grid task-list">
	<form clrForm clrLayout="horizontal" class="">
		<div class="clr-row">
			<div class="clr-col-1">&nbsp;</div>
            <div class="clr-col-10 actions-primary-page-container">
				<tds-button [icon]="'organization'" (click)="onViewTaskGraphHandler()" [title]="'View Task Graph'"></tds-button>
				<tds-button [icon]="'list'" (click)="onViewTimelineHandler()" [title]="'View Timeline'"></tds-button>
			</div>
			<div class="clr-col-1 actions-secondary-page-container">
				<div class="refresh-control">
					<tds-pie-countdown
							[refreshPreference]="TASK_MANAGER_REFRESH_TIMER"
							(timeout)="search()"
							[hideRefresh]="true"
							[customOptions]="[{seconds: 0, description: 'Manual'},
																		{seconds: 60, description: '1 Min'},
																		{seconds: 120, description: '2 Min'},
																		{seconds: 180, description: '3 Min'},
																		{seconds: 240, description: '4 Min'},
																		{seconds: 300, description: '5 Min'}]">
					</tds-pie-countdown>
				</div>
				<tds-button-custom icon="repeat" [displayLabel]="false" [flat]="true" (click)="onFiltersChange()" class="flat" tooltip="Refresh"></tds-button-custom>
			</div>
		</div>

		<div class="clr-row">
			<div class="clr-col-3">
				<clr-select-container class="clr-form-control clr-row">
					<label class="label-event-list">Event: </label>
					<select clrSelect
							class="select-event-list"
							name="selectedEventId"
							[(ngModel)]="selectedEventId"
							(ngModelChange)="onEventSelect()">
						<option
								*ngFor="let event of eventList"
								[attr.selected]="selectedEventId === event.id"
								[value]="event.id">{{ event.name }}</option>
					</select>
				</clr-select-container>
			</div>
			<div class="clr-col-5 checkboxes-container">
                <clr-checkbox-wrapper>
					<input clrCheckbox type="checkbox" name="justRemaining" id="justRemaining" [(ngModel)]="justRemaining" (ngModelChange)="onFiltersChange()">
                    <label>Just Remaining</label>
				</clr-checkbox-wrapper>

				<clr-checkbox-wrapper>
					<input clrCheckbox type="checkbox" name="justMine" id="justMine" [(ngModel)]="justMyTasks" (ngModelChange)="onFiltersChange()">
					<label>Just Mine</label>
				</clr-checkbox-wrapper>

				<clr-checkbox-wrapper>
					<input clrCheckbox type="checkbox" name="viewUnpublished" id="viewUnpublished" [(ngModel)]="viewUnpublished" (ngModelChange)="onFiltersChange()">
					<label>View Unpublished</label>
				</clr-checkbox-wrapper>
			</div>

			<div class="clr-col-4 buttons-container">
				<tds-button [icon]="'plus-circle'" (click)="onCreateTaskHandler()" [title]="'Create Task'" [iconClass]="'is-solid'"></tds-button>
				<tds-button [icon]="'pencil'" (click)="onBulkActionHandler()" [title]="'Bulk Action'"></tds-button>
				<tds-button [icon]="'logout'" [disabled]="!areFiltersDirty()" (click)="onClearFiltersHandler()" [title]="'Clear Filters'"></tds-button>
			</div>
		</div>
	</form>
	<section>
		<div class="box-body box-with-empty-header">
			<kendo-grid
				#gridComponent
				*ngIf="!hideGrid"
				class="task-grid"
				[data]="grid.gridData"
				[pageSize]="grid.state.take"
				[skip]="grid.state.skip"
				[pageable]="{pageSizes: GRID_DEFAULT_PAGINATION_OPTIONS, info: true}"
				(pageChange)="onPageChangeHandler($event)"
				[filterable]="true"
				[resizable]="true"
				[columnMenu]="true"
				[sort]="grid.state.sort"
				[sortable]="{mode:'single'}"
				(sortChange)="onSortChangeHandler($event)"
				(detailExpand)="onRowDetailExpandHandler($event)"
				(detailCollapse)="onRowDetailCollapseHandler($event)"
				(cellClick)="onCellClickHandler($event)">
				<!-- Column Menu -->
				<ng-template kendoGridColumnMenuTemplate let-service="service" let-column="column">
					<div class="k-column-list">
						<label *ngFor="let custom of allAvailableCustomColumns;"
									 [ngClass]="{'invisible': custom.property === currentCustomColumns[column.field]}"
									 class="k-column-list-item ng-star-inserted">
							<input type="radio"
										 value="{{custom.property}}"
										 (ngModelChange)="onCustomColumnChange(column.field, custom, service)"
										 [(ngModel)]="selectedCustomColumn[column.field]">
							<span class="k-checkbox-label"> {{custom.label}} </span>
						</label>
					</div>
				</ng-template>
				<!-- Toolbar -->
				<ng-template kendoGridToolbarTemplate [position]="'top'">
					<div class="button-toolbar">
					</div>
				</ng-template>
				<!-- Row Detail Template -->
				<div *kendoGridDetailTemplate="let dataItem, let rowIndex = rowIndex" class="task-action-buttons-wrapper">
					<div class="task-action-buttons">
						<tds-task-actions
							*ngIf="dataItem.id && dataItem.status"
							[taskStatus]="dataItem.status"
							[showDelayActions]="true"
							[showDetails]="true"
							[buttonClass]="'btn-primary'"
							[taskActionInfoModel]="getTaskActionInfoModel(dataItem.id)"
							(start)="updateTaskStatus(dataItem.id, TaskStatus.STARTED)"
							(done)="updateTaskStatus(dataItem.id, TaskStatus.COMPLETED)"
							(invoke)="invokeActionHandler(dataItem)"
							(reset)="onResetTaskHandler(dataItem)"
							(assignToMe)="onAssignToMeHandler(dataItem)"
							(neighborhood)="onViewTaskNeighborHandler(dataItem)"
							(delay)="changeTimeEst(dataItem, $event)"
							(details)="onOpenTaskDetailHandler(dataItem)">
						</tds-task-actions>
					</div>
					<button *ngIf="dataItem.parsedInstructions"
									class="btn btn-primary btn-xs"
									(click)="openLinkInNewTab(dataItem.parsedInstructions[1])">
						{{dataItem.parsedInstructions[0]}}
					</button>
				</div>
				<kendo-grid-column *ngFor="let column of columnsModel"
													 [resizable]="column.resizable"
													 field="{{column.property}}"
													 [locked]="column.locked"
													 format="{{column.format}}"
													 [headerClass]="column.headerClass ? column.headerClass : ''"
													 [headerStyle]="column.headerStyle ? column.headerStyle : ''"
													 [class]="column.cellClass ? column.cellClass : ''"
													 [style]="column.cellStyle ? column.cellStyle : ''"
													 [width]="!column.width ? 100 : column.width"
													 [columnMenu]="column.columnMenu">
					<!-- Header -->
					<ng-template kendoGridHeaderTemplate>
						<div [ngClass]="{'sortable-column' : (column.type !== 'action' && column.sortable !==	false)}">
							<label>{{column.label}}</label>
						</div>
					</ng-template>
					<!-- edit action column -->
					<ng-template kendoGridCellTemplate *ngIf="column.type === 'action'" let-dataItem>
						<div class="is-grid-link tds-action-button-set">
							<tds-button-edit (click)="onOpenTaskEditHandler(dataItem)"></tds-button-edit>
						</div>
					</ng-template>
					<!-- task Number -->
					<ng-template kendoGridCellTemplate *ngIf="column.property === 'taskNumber'" let-dataItem>
						<span class="is-grid-link" (click)="onOpenTaskDetailHandler(dataItem)">{{dataItem.taskNumber}}</span>
					</ng-template>
					<!-- asset name -->
					<ng-template kendoGridCellTemplate *ngIf="currentCustomColumns[column.property] === 'assetName'"
											 let-dataItem>
								<span class="is-grid-link"
											(click)="onOpenAssetDetailHandler(dataItem)">{{dataItem[column.property]}}</span>
					</ng-template>
					<!-- updated -->
					<ng-template kendoGridCellTemplate *ngIf="column.property === 'updatedTime'" let-dataItem>
						<span class="task-updated-cell {{dataItem.updatedClass}} overflow-ellipsis">{{dataItem.updatedTime}}</span>
					</ng-template>
					<!-- status -->
					<ng-template kendoGridCellTemplate *ngIf="column.property === 'status'" let-dataItem>
						<span class="task-status-cell {{dataItem.taskStatus}}">{{dataItem.status}}</span>
					</ng-template>
					<ng-template kendoGridFilterCellTemplate let-filter>
						<div class="has-feedback" *ngIf="column.filterable" style="margin-bottom: 5px;">
							<div *ngIf="column.type === 'text'; then stringFilter"></div>
							<ng-template #stringFilter>
								<tds-filter-input
									name="{{column.property}}"
									[value]="column.filter || ''"
									placeholder="{{'GLOBAL.FILTER' | translate}}"
									(filter)="onFilterChangeHandler($event, column)">
								</tds-filter-input>
							</ng-template>
						</div>
					</ng-template>
				</kendo-grid-column>
			</kendo-grid>
		</div>
	</section>
</div>
