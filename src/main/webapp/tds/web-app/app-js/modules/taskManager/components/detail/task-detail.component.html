<div
	tds-autofocus
	tds-handle-escape
	(escPressed)="cancelCloseDialog()"
	class="task-detail-component modal fade in tds-ui-modal-decorator"
	id="task-detail-component"
	data-backdrop="static"
	tabindex="-1"
	role="dialog"
>
	<div class="modal-dialog modal-lg" role="document">
		<div
			class="tds-modal-content resizable tds-angular-component-content has-side-nav"
			tds-ui-modal-decorator=""
			[options]="modalOptions"
			[style.width.px]="SHARED_TASK_SETTINGS.DEFAULT_TASK_HEIGHT"
			[style.height.px]="SHARED_TASK_SETTINGS.DEFAULT_TASK_WIDTH"
		>
			<div class="modal-header">
				<button aria-label="Close" class="close" type="button" (click)="cancelCloseDialog($event)" >
					<clr-icon aria-hidden="true" shape="close"></clr-icon>
				</button>
				<h4 class="modal-title">{{ model.title }}</h4>
			</div>
			<div class="task-detail-container">
				<div class="modal-body">
					<form>
						<table class="full-height">
							<tbody class="full-height task-layout">
								<tr class="no-grow-container">
									<td colspan="2">
										<div class="btn-collapsed-fixed-right">
											<tds-button-collapse
												[displayLabel]="false"
												*ngIf="!collapsedTaskDetail"
												(click)="onCollapseTaskDetail()"
											></tds-button-collapse>
											<tds-button-expand
												[displayLabel]="false"
												*ngIf="collapsedTaskDetail"
												(click)="onCollapseTaskDetail()"
											></tds-button-expand>
										</div>
										<div class="dialog tds-table">
											<table class="task-details">
												<tbody>
													<tr class="prop">
														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																class="task-number"
																>Task #
																{{
																	model.taskNumber
																}}</label
															>
														</td>
														<td
															class="valueNW"
															class="task-comment"
															colspan="5"
														>
															<span>{{
																model.comment
															}}</span>
														</td>
													</tr>
													<tr
														*ngIf="
															!collapsedTaskDetail
														"
														class="prop"
													>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Person</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																(model.assignedTo &&
																	model
																		.assignedTo
																		.text) ||
																	''
															}}</span>
														</td>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label>Team</label>
														</td>
														<td class="valueNW">
															<span>{{
																(model.assignedTeam &&
																	model
																		.assignedTeam
																		.text) ||
																	''
															}}</span>
														</td>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label>Event</label>
														</td>
														<td class="valueNW">
															<span>{{
																(model.event &&
																	model.event
																		.text) ||
																	''
															}}</span>
														</td>
													</tr>
													<tr
														*ngIf="
															!collapsedTaskDetail
														"
														class="prop"
													>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Fixed
																Assignment</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.hardAssigned
															}}</span>
														</td>

														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Send
																Notification</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.sendNotification
															}}</span>
														</td>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Action</label
															>
														</td>
														<td class="valueNW">
															<a
																(click)="
																	openTaskActionSummaryDetailHandler()
																"
																>{{
																	(model.apiAction &&
																		model
																			.apiAction
																			.text) ||
																		''
																}}</a
															>
														</td>
													</tr>

													<tr
														*ngIf="
															!collapsedTaskDetail
														"
														class="prop"
													>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Category</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.category
															}}</span>
														</td>
														<td
															class="url N"
															nowrap="nowrap"
														>
															<label
																><span
																	>Asset
																	class</span
																></label
															>
														</td>
														<td class="valueNW">
															<span>{{
																(model.assetClass &&
																	model
																		.assetClass
																		.text) ||
																	''
															}}</span>
														</td>

														<td
															class="N"
															nowrap="nowrap"
														>
															<label>Asset</label>
														</td>
														<td class="valueNW">
															<a
																(click)="
																	onOpenLinkAsset()
																"
																>{{
																	model.asset &&
																		model
																			.asset
																			.text
																}}</a
															>
														</td>
													</tr>

													<tr
														*ngIf="
															!collapsedTaskDetail
														"
														class="prop"
													>
														<td
															class="url N"
															nowrap="nowrap"
														>
															<label
																>Instruction
																Link</label
															>
														</td>
														<td class="valueNW">
															<span
																><tds-url-viewer
																	*ngIf="
																		model.instructionLink
																	"
																	[model]="
																		model.instructionLink
																	"
																></tds-url-viewer
															></span>
														</td>

														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Priority</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.priority
															}}</span>
														</td>

														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Due Date</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.dueDate ||
																	''
															}}</span>
														</td>
													</tr>

													<tr
														*ngIf="
															!collapsedTaskDetail
														"
														class="prop"
													>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Estimated
																Duration</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.durationText
															}}</span>
														</td>

														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Estimated
																Start</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.estimatedStart ||
																	''
																	| tdsDateTime
																		: userTimeZone
															}}</span>
														</td>

														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Estimated
																Finish</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.estimatedFinish ||
																	''
																	| tdsDateTime
																		: userTimeZone
															}}</span>
														</td>
													</tr>

													<tr
														*ngIf="
															!collapsedTaskDetail
														"
														class="prop"
													>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Actual
																Start</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.actualStart ||
																	''
															}}</span>
														</td>

														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Actual
																Finish</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.actualFinish ||
																	''
															}}</span>
														</td>

														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Actual
																Duration</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.actualDuration
															}}</span>
														</td>
													</tr>

													<tr
														*ngIf="
															!collapsedTaskDetail
														"
														class="prop"
													></tr>
													<tr
														*ngIf="
															!collapsedTaskDetail
														"
														class="prop"
													>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Status</label
															>
														</td>
														<td class="valueNW">
															<tds-task-status-indicator
																[propertyName]="
																	'status'
																"
																[value]="
																	model.status
																"
															></tds-task-status-indicator>
														</td>

														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Duration
																Delta</label
															>
														</td>
														<td class="valueNW">
															<span>{{
																model.durationDelta
															}}</span>
														</td>
													</tr>

													<tr
														*ngIf="
															!collapsedTaskDetail
														"
														class="prop"
													>
														<td
															class="N"
															nowrap="nowrap"
														>
															<label
																>Completion
																%:</label
															>
														</td>
														<td class="valueNW">
															<div
																class="progress completion"
															>
																<div
																	class="progress-bar"
																	role="progressbar"
																	[style.width.%]="
																		model.percentageComplete
																	"
																	[attr.aria-valuenow]="
																		model.percentageComplete
																	"
																	[attr.aria-valuemin]="
																		0
																	"
																	[attr.aria-valuemax]="
																		100
																	"
																>
																	{{
																		model.percentageComplete
																	}}
																	%
																</div>
															</div>
														</td>
													</tr>
												</tbody>
											</table>
										</div>
									</td>
								</tr>
								<tr
									class="no-grow-container"
									*ngIf="!collapsedTaskDetail"
								>
									<td
										class="dates-info-container"
										colspan="2"
									>
										<table class="dates-info">
											<tbody>
												<tr>
													<td class="date-created">
														Created by
														{{
															model.personCreateObj
														}}
														at
														{{
															model.dateCreated
																| date
																	: dateFormatTime
														}}
														{{
															model.taskSpecId
																? ' with spec id ' +
																  model.taskSpecId
																: ''
														}}
														<span
															*ngIf="
																model.recipe &&
																hasCookbookPermission
															"
														>
															in recipe
															<a
																href="./../cookbook/index#/recipes/{{
																	model.recipe
																		?.id
																}}/gentasks/start"
															>
																{{
																	model.recipe
																		?.name
																}}</a
															>
														</span>
													</td>
													<td class="last-updated">
														Last updated:
														{{
															model.lastUpdated
																| date
																	: dateFormatTime
														}}
													</td>
												</tr>
											</tbody>
										</table>
									</td>
								</tr>
								<tr class="deps no-grow-container">
									<table>
										<tr>
											<td valign="top">
												<kendo-grid
													*ngIf="
														dataGridTaskPredecessorsHelper &&
														modelHelper
													"
													class="successor-predecessor-table"
													[data]="
														dataGridTaskPredecessorsHelper.gridData
													"
													[sort]="
														dataGridTaskPredecessorsHelper
															.state.sort
													"
													[sortable]="{
														mode: 'single'
													}"
													[resizable]="false"
													(sortChange)="
														dataGridTaskPredecessorsHelper.sortChange(
															$event
														)
													"
													[rowClass]="
														modelHelper.rowStatusColor
													"
												>
													<!-- Toolbar Template -->
													<ng-template kendoGridToolbarTemplate [position]="'top'">
														<div class="table-container">
															<label class="table-title">Predecessors
																({{ dataGridTaskPredecessorsHelper
																		.gridData
																		.data
																		.length
																}})</label >
															<tds-button-add title="Create" [displayLabel]="false"
																[small]="true"
																iconClass="is-solid"
																[tooltip]="modelHelper.CREATE_PREDECESSOR"
																[id]="'btnAddPredecessor'"
																(click)="onAddTaskDependency(model.predecessorList,dataGridTaskPredecessorsHelper)">
															</tds-button-add>
														</div>
													</ng-template>

													<!-- Columns -->
													<kendo-grid-column
														*ngFor="
															let column of taskSuccessorPredecessorColumnsModel.columns
														"
														field="{{
															column.property
														}}"
														[width]="
															!column.width
																? COLUMN_MIN_WIDTH
																: column.width
														"
													>
														<!-- Header Template -->
														<ng-template
															kendoGridHeaderTemplate
														>
															<label>{{
																column.label
															}}</label>
														</ng-template>

														<ng-template
															kendoGridCellTemplate
															*ngIf="
																column.property ===
																'taskNumber'
															"
															let-dataItem
															let-rowIndex="rowIndex"
														>
															<label
																class="pointer pad-left-7"
																(click)="
																	openTaskDetail(
																		dataItem,
																		modalType.VIEW
																	)
																"
																>{{
																	dataItem.taskNumber
																}}</label
															>
														</ng-template>

														<ng-template
															kendoGridCellTemplate
															*ngIf="
																column.property ===
																'desc'
															"
															let-dataItem
															let-rowIndex="rowIndex"
														>
															<label
																class="pointer pad-left-7"
																(click)="
																	openTaskDetail(
																		dataItem,
																		modalType.VIEW
																	)
																"
																>{{
																	dataItem.desc
																}}</label
															>
														</ng-template>

														<ng-template kendoGridCellTemplate
																	 let-dataItem
																	 let-rowIndex="rowIndex"
																	 *ngIf="column.property === 'status'">
															<tds-task-status-indicator
																	class=""
																	[propertyName]="column.property"
																	[value]="dataItem[column.property]">
															</tds-task-status-indicator>
														</ng-template>

														<ng-template
															kendoGridCellTemplate
															let-dataItem
															let-rowIndex="rowIndex"
														>
															<label
																class="pad-left-7"
																>{{
																	dataItem[
																		column
																			.property
																	]
																}}</label
															>
														</ng-template>
													</kendo-grid-column>
													<kendo-grid-messages
														noRecords="There are no records to display."
													>
													</kendo-grid-messages>
												</kendo-grid>
											</td>
											<td valign="top">
												<kendo-grid
													*ngIf="
														dataGridTaskSuccessorsHelper &&
														modelHelper
													"
													class="successor-predecessor-table"
													[data]="
														dataGridTaskSuccessorsHelper.gridData
													"
													[sort]="
														dataGridTaskSuccessorsHelper
															.state.sort
													"
													[sortable]="{
														mode: 'single'
													}"
													[resizable]="false"
													(sortChange)="
														dataGridTaskSuccessorsHelper.sortChange(
															$event
														)
													"
													[rowClass]="
														modelHelper.rowStatusColor
													"
												>
													<!-- Toolbar Template -->
													<ng-template
														kendoGridToolbarTemplate
														[position]="'top'"
													>
														<div
															class="table-container"
														>
															<label
																class="table-title"
																>Successors ({{
																	dataGridTaskSuccessorsHelper
																		.gridData
																		.data
																		.length
																}})</label
															>
															<tds-button-add
																title="Create"
																[displayLabel]="
																	false
																"
																iconClass="is-solid"
																[small]="true"
																[tooltip]="
																	modelHelper.CREATE_SUCCESSOR
																"
																[id]="
																	'btnAddSuccessor'
																"
																(click)="
																	onAddTaskDependency(
																		model.successorList,
																		dataGridTaskSuccessorsHelper
																	)
																"
															>
															</tds-button-add>
														</div>
													</ng-template>
													<!-- Columns -->
													<kendo-grid-column
														*ngFor="
															let column of taskSuccessorPredecessorColumnsModel.columns
														"
														field="{{
															column.property
														}}"
														[width]="
															!column.width
																? COLUMN_MIN_WIDTH
																: column.width
														"
													>
														<!-- Header Template -->
														<ng-template
															kendoGridHeaderTemplate
														>
															<label>{{
																column.label
															}}</label>
														</ng-template>

														<ng-template
															kendoGridCellTemplate
															*ngIf="
																column.property ===
																'taskNumber'
															"
															let-dataItem
															let-rowIndex="rowIndex"
														>
															<label
																class="pointer pad-left-7"
																(click)="
																	openTaskDetail(
																		dataItem,
																		modalType.VIEW
																	)
																"
																>{{
																	dataItem.taskNumber
																}}</label
															>
														</ng-template>

														<ng-template
															kendoGridCellTemplate
															*ngIf="
																column.property ===
																'desc'
															"
															let-dataItem
															let-rowIndex="rowIndex"
														>
															<label
																class="pointer pad-left-7"
																(click)="
																	openTaskDetail(
																		dataItem,
																		modalType.VIEW
																	)
																"
																>{{
																	dataItem.desc
																}}</label
															>
														</ng-template>

														<ng-template kendoGridCellTemplate
																	 let-dataItem
																	 let-rowIndex="rowIndex"
																	 *ngIf="column.property === 'status'">
															<tds-task-status-indicator
																	class=""
																	[propertyName]="column.property"
																	[value]="dataItem[column.property]">
															</tds-task-status-indicator>
														</ng-template>

														<ng-template
															kendoGridCellTemplate
															let-dataItem
															let-rowIndex="rowIndex"
														>
															<label
																class="pad-left-7"
																>{{
																	dataItem[
																		column
																			.property
																	]
																}}</label
															>
														</ng-template>
													</kendo-grid-column>
													<kendo-grid-messages
														noRecords="There are no records to display."
													>
													</kendo-grid-messages>
												</kendo-grid>
											</td>
										</tr>
									</table>
								</tr>
								<tr class="deps grow-container">
									<td colspan="5">
										<tds-task-notes
											[dataGridTaskNotesHelper]="
												dataGridTaskNotesHelper
											"
											(create)="createNote()"
										></tds-task-notes>
									</td>
								</tr>
							</tbody>
						</table>
					</form>
				</div>
				<div class="modal-footer">
					<div class="options-container">
						<div class="options">
							<tds-task-actions
								*ngIf="model.id && model.status"
								style="text-align: left"
								[taskStatus]="model.status"
								[displayAsButtons]="true"
								[taskActionInfoModel]="taskActionInfoModel"
								(start)="onStartTask()"
								(done)="onDoneTask()"
								(invoke)="onInvoke()"
								(reset)="onReset()"
								(assignToMe)="onAssignToMe()"
								(neighborhood)="onNeighborhood()"
							>
							</tds-task-actions>
						</div>
					</div>
				</div>
			</div>

			<div class="modal-sidenav form-group-center">
				<nav class="modal-sidenav btn-link">
					<tds-button-edit
						(click)="editTaskDetail()"
						[disabled]="!hasEditTaskPermission"
					></tds-button-edit>
					<tds-button-delete
						(click)="deleteTask()"
						[disabled]="!hasDeleteTaskPermission"
					></tds-button-delete>
					<tds-button-close
						(click)="cancelCloseDialog()"
					></tds-button-close>
				</nav>
			</div>
		</div>
	</div>
</div>
