<div tds-autofocus tds-handle-escape (escPressed)="cancelCloseDialog()"
     class="task-detail-component modal fade in tds-ui-modal-decorator"
     id="task-detail-component" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="tds-modal-content resizable tds-angular-component-content"
             tds-ui-modal-decorator=""
             [options]="modalOptions"
             [style.width.px]="SHARED_TASK_SETTINGS.DEFAULT_TASK_HEIGHT"
             [style.height.px]="SHARED_TASK_SETTINGS.DEFAULT_TASK_WIDTH">
            <div class="modal-header">
				<button aria-label="Close" class="close" type="button" (click)="cancelCloseDialog($event)">
					<clr-icon aria-hidden="true" shape="close"></clr-icon>
				</button>
                <h4 class="modal-title">{{model.title}}</h4>
            </div>
            <div class="modal-body">
                <div class="full-height">
                    <table style="border: 0;" class="full-height">
                        <tbody class="full-height task-layout">
                            <tr class="no-grow-container">
                                <td colspan="2">
                                    <div class="btn-collapsed-fixed-right">
                                        <tds-button-collapse [displayLabel]="false"  *ngIf="!collapsedTaskDetail" (click)="onCollapseTaskDetail()"></tds-button-collapse>
                                        <tds-button-expand  [displayLabel]="false" *ngIf="collapsedTaskDetail" (click)="onCollapseTaskDetail()"></tds-button-expand>
                                    </div>
                                    <div class="dialog">
                                        <table class="task-details">
                                            <tbody>
                                                <tr class="prop">
                                                    <td class="N" nowrap="nowrap">
                                                        <label style="min-width: 104px;">Task # {{model.taskNumber}}</label>
                                                    </td>
                                                    <td class="valueNW" colspan="5" style="max-width: 400px; font-weight:bold;">
                                                        <span>{{model.comment}}</span>
                                                    </td>
                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="N" nowrap="nowrap">
                                                        <label>Person</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.assignedTo && model.assignedTo.text || ''}}</span></td>
                                                    <td class="N" nowrap="nowrap">
                                                        <label>Team</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.assignedTeam && model.assignedTeam.text || ''}}</span></td>
                                                    <td class="N" nowrap="nowrap">
                                                        <label>Event</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.event && model.event.text || ''}}</span></td>



                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
	                                                <td class="N" nowrap="nowrap">
                                                        <label>Fixed Assignment</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.hardAssigned}}</span></td>

                                                    <td class="N" nowrap="nowrap">
                                                        <label>Send Notification</label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <span>{{ model.sendNotification }}</span>
                                                    </td>
                                                    <td class="N" nowrap="nowrap">
                                                        <label>Action</label>
                                                    </td>
                                                    <td class="valueNW"><a (click)="openTaskActionSummaryDetailHandler()">{{model.apiAction && model.apiAction.text || ''}}</a></td>
                                                </tr>

                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="N" nowrap="nowrap">
                                                        <label>Category</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.category}}</span></td>
                                                    <td class="url N" nowrap="nowrap">
                                                        <label><span>Asset class</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <span>{{ model.assetClass && model.assetClass.text || ''}}</span>
                                                    </td>

                                                    <td class="N" nowrap="nowrap">
                                                        <label>Asset</label>
                                                    </td>
                                                    <td class="valueNW"><a (click)="onOpenLinkAsset()">{{model.asset && model.asset.text}}</a></td>
                                                </tr>


                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="url N" nowrap="nowrap">
                                                        <label>Instruction Link</label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <span><tds-url-viewer *ngIf="model.instructionLink" [model]="model.instructionLink"></tds-url-viewer></span>
                                                    </td>

                                                    <td class="N" nowrap="nowrap">
                                                        <label>Priority</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.priority}}</span></td>

                                                    <td class="N" nowrap="nowrap">
                                                        <label>Due Date</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.dueDate || ''}}</span></td>
                                                </tr>


                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="N" nowrap="nowrap">
                                                        <label>Estimated Duration</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.durationText}}</span>

                                                    <td class="N" nowrap="nowrap">
                                                        <label>Estimated Start</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.estimatedStart || ''}}</span></td>

                                                    <td class="N" nowrap="nowrap">
                                                        <label>Estimated Finish</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.estimatedFinish || ''}}</span></td>

                                                </tr>


                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="N" nowrap="nowrap">
                                                        <label>Actual Start</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.actualStart || ''}}</span></td>

                                                     <td class="N" nowrap="nowrap">
														<label>Actual Finish</label>
														</td>
														<td class="valueNW"><span>{{model.actualFinish || ''}}</span>
                                                     </td>

                                                    <td class="N" nowrap="nowrap">
                                                        <label>Actual Duration</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.actualDuration}}</span></td>


                                                </tr>

                                                <tr *ngIf="!collapsedTaskDetail" class="prop">

                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                     <td class="N" nowrap="nowrap">
													  <label>Status</label>
												  </td>
												  <td class="valueNW task-{{model.status |  lowercase}}">
													  <span>{{model.status}}</span>
												  </td>

                                                    <td class="N" nowrap="nowrap">
                                                        <label>Duration Delta</label>
                                                    </td>
                                                    <td class="valueNW"><span>{{model.durationDelta}}</span></td>
                                                </tr>

                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="N" nowrap="nowrap">
                                                         <label>Completion %:</label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <div class="progress completion">
                                                                <div class="progress-bar" role="progressbar" 
                                                                    [style.width.%]="model.percentageComplete" 
                                                                    [attr.aria-valuenow]="model.percentageComplete" 
                                                                    [attr.aria-valuemin]="0" 
                                                                    [attr.aria-valuemax]="100">
                                                                    {{model.percentageComplete}} %
                                                                </div>
                                                        </div>	
                                                    </td>
                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                            <tr class="no-grow-container"  *ngIf="!collapsedTaskDetail">
                                <td class="dates-info-container" colspan="2">
                                    <table class="dates-info">
                                        <tbody>
                                            <tr>
                                                <td class="date-created">
                                                    Created by {{model.personCreateObj}} at {{model.dateCreated | date:dateFormatTime}}
                                                    {{(model.taskSpecId)? ' with spec id ' + model.taskSpecId: ''}}
                                                    <span *ngIf="model.recipe && hasCookbookPermission"> in recipe
                                                        <a href="./../cookbook/index#/recipes/{{model.recipe?.id}}/gentasks/start"> {{model.recipe?.name}}</a>
                                                    </span>
                                                </td>
                                                <td class="last-updated">Last updated: {{model.lastUpdated | date:dateFormatTime}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            <tr class="deps no-grow-container">
                                <table>
                                    <tr>
                                        <td valign="top">
                                            <kendo-grid
                                                    *ngIf="dataGridTaskPredecessorsHelper && modelHelper"
                                                    class="successor-predecessor-table"
                                                    [data]="dataGridTaskPredecessorsHelper.gridData"
                                                    [sort]="dataGridTaskPredecessorsHelper.state.sort"
                                                    [sortable]="{mode:'single'}"
                                                    [resizable]="false"
                                                    (sortChange)="dataGridTaskPredecessorsHelper.sortChange($event)"
                                                    [rowClass]="modelHelper.rowStatusColor">
                                                    <!-- Toolbar Template -->
                                                    <ng-template kendoGridToolbarTemplate [position]="'top'">
                                                        <div>
                                                            <label class="pad-top-2 pad-left-10 mar-bottom-0">Predecessors ({{dataGridTaskPredecessorsHelper.gridData.data.length}})</label>
                                                            <tds-button-add class="float-right"
                                                                            title="Create"
                                                                            [displayLabel]="false"
                                                                            [small]="true"
                                                                            [tooltip]="modelHelper.CREATE_PREDECESSOR"
                                                                            [id]="'btnAddPredecessor'"
                                                                            (click)="onAddTaskDependency(model.predecessorList, dataGridTaskPredecessorsHelper)">
                                                            </tds-button-add>
                                                        </div>
                                                    </ng-template>
                                                    <!-- Columns -->
                                                    <kendo-grid-column *ngFor="let column of taskSuccessorPredecessorColumnsModel.columns"
                                                                       field="{{column.property}}"
                                                                       [width]="!column.width ? COLUMN_MIN_WIDTH : column.width">
                                                        <!-- Header Template -->
                                                        <ng-template kendoGridHeaderTemplate>
                                                            <label>{{column.label}}</label>
                                                        </ng-template>

                                                        <ng-template kendoGridCellTemplate *ngIf="column.property === 'taskNumber'" let-dataItem let-rowIndex="rowIndex">
                                                            <label class="pointer pad-left-7" (click)="openTaskDetail(dataItem, modalType.VIEW)">{{dataItem.taskNumber}}</label>
                                                        </ng-template>

                                                        <ng-template kendoGridCellTemplate *ngIf="column.property === 'desc'" let-dataItem let-rowIndex="rowIndex">
                                                            <label class="pointer pad-left-7" (click)="openTaskDetail(dataItem, modalType.VIEW)">{{dataItem.desc}}</label>
                                                        </ng-template>

                                                        <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex">
                                                            <label class="pad-left-7">{{dataItem[column.property]}}</label>
                                                        </ng-template>

                                                    </kendo-grid-column>
                                                <kendo-grid-messages noRecords="There are no records to display."> </kendo-grid-messages>
                                            </kendo-grid>
                                        </td>
                                        <td valign="top">
                                            <kendo-grid
                                                    *ngIf="dataGridTaskSuccessorsHelper && modelHelper"
                                                    class="successor-predecessor-table"
                                                    [data]="dataGridTaskSuccessorsHelper.gridData"
                                                    [sort]="dataGridTaskSuccessorsHelper.state.sort"
                                                    [sortable]="{mode:'single'}"
                                                    [resizable]="false"
                                                    (sortChange)="dataGridTaskSuccessorsHelper.sortChange($event)"
                                                    [rowClass]="modelHelper.rowStatusColor">
                                                <!-- Toolbar Template -->
                                                <ng-template kendoGridToolbarTemplate [position]="'top'">
                                                    <label class="pad-top-2 pad-left-10 mar-bottom-0">Successors ({{dataGridTaskSuccessorsHelper.gridData.data.length}})</label>
                                                    <tds-button-add class="button-header-grid float-right"
                                                                    title="Create"
                                                                    [tooltip]="modelHelper.CREATE_SUCCESSOR"
                                                                    [id]="'btnAddSuccessor'"
                                                                    (click)="onAddTaskDependency(model.successorList, dataGridTaskSuccessorsHelper)">
                                                    </tds-button-add>
                                                </ng-template>
                                                <!-- Columns -->
                                                <kendo-grid-column *ngFor="let column of taskSuccessorPredecessorColumnsModel.columns"
                                                                   field="{{column.property}}"
                                                                   [width]="!column.width ? COLUMN_MIN_WIDTH : column.width">
                                                    <!-- Header Template -->
                                                    <ng-template kendoGridHeaderTemplate>
                                                        <label>{{column.label}}</label>
                                                    </ng-template>

                                                    <ng-template kendoGridCellTemplate *ngIf="column.property === 'taskNumber'" let-dataItem let-rowIndex="rowIndex">
                                                        <label class="pointer pad-left-7" (click)="openTaskDetail(dataItem, modalType.VIEW)">{{dataItem.taskNumber}}</label>
                                                    </ng-template>

                                                    <ng-template kendoGridCellTemplate *ngIf="column.property === 'desc'" let-dataItem let-rowIndex="rowIndex">
                                                        <label class="pointer pad-left-7" (click)="openTaskDetail(dataItem, modalType.VIEW)">{{dataItem.desc}}</label>
                                                    </ng-template>

                                                    <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex" >
                                                        <label class="pad-left-7">{{dataItem[column.property]}}</label>
                                                    </ng-template>

                                                </kendo-grid-column>
                                                <kendo-grid-messages noRecords="There are no records to display."> </kendo-grid-messages>
                                            </kendo-grid>
                                         </td>
                                    </tr>
                                </table>
                            </tr>
                            <tr class="deps grow-container">
                                <td colspan="5">
                                    <tds-task-notes [dataGridTaskNotesHelper]="dataGridTaskNotesHelper"
                                                    (create)="createNote()"></tds-task-notes>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer form-group-center">
					<div class="pull-left" style="display: flex;">
                    <button class="btn btn-primary" (click)="editTaskDetail()" type="button" [disabled]="!hasEditTaskPermission">
						<clr-icon aria-hidden="true" shape="pencil"></clr-icon>
                        <span>Edit</span>
                    </button>
                    <tds-task-actions
														*ngIf="model.id && model.status"
														[taskStatus]="model.status"
														[taskActionInfoModel]="taskActionInfoModel"
                            (start)="onStartTask()"
                            (done)="onDoneTask()"
                            (invoke)="onInvoke()"
														(reset)="onReset()"
                            (assignToMe)="onAssignToMe()"
                            (neighborhood)="onNeighborhood()">
										</tds-task-actions>
                </div>
                <button (click)="deleteTask()" type="button" class="btn btn-danger component-action-delete" [disabled]="!hasDeleteTaskPermission">
					<clr-icon aria-hidden="true" shape="trash"></clr-icon>
                    <span>Delete</span>
                </button>
                <button (click)="cancelCloseDialog()" type="button" class="btn btn-default component-action-cancel pull-right">
					<clr-icon aria-hidden="true" shape="ban"></clr-icon>
                    <span>Close</span>
                </button>

            </div>
        </div>
    </div>
</div>
