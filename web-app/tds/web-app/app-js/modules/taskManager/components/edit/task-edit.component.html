<div tds-autofocus tds-handle-escape (escPressed)="cancelCloseDialog()" class="task-detail-component modal fade in tds-ui-modal-decorator" id="task-edit-component" data-backdrop="static" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content resizable tds-angular-component-content"
             tds-ui-modal-decorator=""
             (resizeEvent)="resizeWindow($event)"
             [options]="modalOptions"
             [style.width.px]="860"
             [style.height.px]="706">
            <div class="modal-header">
                <button (click)="cancelCloseDialog()" type="button" class="close" aria-label="Close">
                    <span aria-hidden="true">Ã—</span>
                </button>
                <h4 class="modal-title">Edit: {{taskDetailModel.modal.title}}</h4>
            </div>
            <div class="modal-body">
                <form #taskEditForm="ngForm" class="full-height">
                    <table style="border: 0;" class="full-height">
                        <tbody class="full-height task-layout">
                            <tr class="no-grow-container">
                                <td class="task-details" colspan="2">
	                                <!--
                                    <div class="btn-collapsed-fixed-right">
                                        <button class="btn btn-default" (click)="onCollapseTaskDetail()">
                                            <i class="fa" [ngClass]="{'fa-angle-double-down': !collapsedTaskDetail, 'fa-angle-double-right': collapsedTaskDetail}"></i>
                                        </button>
                                    </div>
                                    -->
                                    <div class="dialog">
                                        <table>
                                            <tbody>
                                                <tr class="prop">
                                                    <td class="label U" nowrap="nowrap">
                                                        <label style="min-width: 104px;"><span>Task # {{model.taskNumber}}</span></label>
                                                    </td>
                                                    <td class="valueNW description-container" colspan="5">
                                                        <input type="text" name="comment" [(ngModel)]="model.comment" required>
                                                        <button class="btn btn-default" (click)="onCollapseTaskDetail()">
                                                            <i class="fa" [ngClass]="{'fa-angle-double-down': !collapsedTaskDetail, 'fa-angle-double-right': collapsedTaskDetail}"></i>
                                                        </button>
                                                    </td>
                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Status</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="statusList"
                                                                [class]="'form-control status task-' + model.status.toLowerCase()"
                                                                [data]="model.statusList"
                                                                [(ngModel)]="model.status"
                                                                (valueChange)="onStatusChange($event)">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                    <td class="label url U" nowrap="nowrap">
                                                        <label><span>Asset class</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="assetClass"
                                                                class="form-control"
                                                                [data]="model.assetClasses"
                                                                [textField]="'text'"
                                                                [valueField]="'id'"
                                                                [(ngModel)]="model.assetClass"
                                                                (valueChange)="onAssetClassChange($event)">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Asset</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <tds-combobox
                                                                [(model)]="model.asset"
                                                                [(metaParam)]="model.assetClass.id"
                                                                [serviceRequest]="getAssetList"
                                                                (valueChange)="onAssetNameChange($event)">
                                                        </tds-combobox>
                                                    </td>
                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Team</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="team"
                                                                class="form-control"
                                                                [data]="model.teamList"
                                                                [textField]="'text'"
                                                                [valueField]="'id'"
                                                                [(ngModel)]="model.assignedTeam"
                                                                (valueChange)="onTeamChange($event)">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Priority</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="priority"
                                                                class="form-control"
                                                                [data]="model.priorityList"
                                                                [(ngModel)]="model.priority">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Action</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="apiActionList"
                                                                [data]="model.apiActionList"
                                                                [textField]="'text'"
                                                                [valueField]="'id'"
                                                                [(ngModel)]="model.apiAction">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Person</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="assignedTo"
                                                                class="form-control"
                                                                [data]="model.personList"
                                                                [textField]="'text'"
                                                                [valueField]="'id'"
                                                                [(ngModel)]="model.assignedTo"
                                                                (valueChange)="onPersonChange($event)">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                    <td class="label url U" nowrap="nowrap">
                                                        <label><span>Fixed Assignment</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="hardAssignment"
                                                                [(ngModel)]="model.hardAssigned"
                                                                [data]="yesNoList">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                    <td class="label url U" nowrap="nowrap">
                                                        <label><span>Send Notification</span></label>
                                                    </td>
                                                    <td  class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="sendNotification"
                                                                [(ngModel)]="model.sendNotification"
                                                                [data]="yesNoList">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Event</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="event"
                                                                class="form-control"
                                                                [data]="model.eventList"
                                                                [textField]="'text'"
                                                                [valueField]="'id'"
                                                                [(ngModel)]="model.event" readonly="true">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Category</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dropdownlist
                                                                name="category"
                                                                [data]="model.categoriesList"
                                                                [(ngModel)]="model.category">
                                                        </kendo-dropdownlist>
                                                    </td>
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Instruction Link</span></label>
                                                    </td>
                                                    <td class="valueNW instructions-link">
                                                        <input type="text" name="instructionLink"
                                                               placeholder="Enter URL or Label|URL"
                                                               [(ngModel)]="model.instructionLink" />
                                                    </td>
                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Due Date</span></label>
                                                    </td>

                                                    <td class="valueNW">
                                                        <kendo-datepicker
                                                                name="dueDate"
                                                                [format]="dateFormat"
                                                                [(value)]="model.dueDate">
                                                        </kendo-datepicker>
                                                    </td>

                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Actual start</span></label>
                                                    </td>

                                                    <td class="valueNW">
                                                        <kendo-datepicker
                                                                name="actualStart"
                                                                [format]="dateFormat"
                                                                [(value)]="model.actualStart">
                                                        </kendo-datepicker>
                                                    </td>

                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Actual Finish</span></label>
                                                    </td>

                                                    <td class="valueNW">
                                                        <kendo-datepicker
                                                                name="actualFinish"
                                                                [format]="dateFormat"
                                                                [(value)]="model.actualFinish">
                                                        </kendo-datepicker>
                                                    </td>
                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Estimated Start</span></label>
                                                    </td>
                                                    <td class="valueNW">
                                                        <kendo-dateinput
                                                                name="estimatedStart"
                                                                class="clickable"
                                                                (click)="openRangeDatesSelector()"
                                                                [format]="getDateTimeFormat(model.estimatedStart)"
                                                                [(value)]="model.estimatedStart" readonly="true">
                                                        </kendo-dateinput>
                                                    </td>

                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Estimated Finish</span></label>
                                                    </td>

                                                    <td class="valueNW estimated-finish">
                                                        <kendo-dateinput
                                                                name="estimatedFinish"
                                                                class="clickable"
                                                                [format]="getDateTimeFormat(model.estimatedFinish)"
                                                                (click)="openRangeDatesSelector()"
                                                                [(ngModel)]="model.estimatedFinish">
                                                        </kendo-dateinput>
                                                        <span (click)="cleanEstimatedDates()" *ngIf="model.estimatedFinish"
                                                              class="glyphicon glyphicon-remove delete-command" title="Delete estimation dates"></span>
                                                    </td>

                                                    <td class="label U" nowrap="nowrap">
                                                       <label><span>TaskSpec ID</span></label>
                                                    </td>

                                                    <td class="valueNW">
                                                        <span>{{model.taskSpec}}</span>
                                                    </td>
                                                </tr>
                                                <tr *ngIf="!collapsedTaskDetail" class="prop">
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Estimated Duration</span></label>
                                                    </td>
                                                    <td class="valueNW">

                                                        <div class="duration-controls">
                                                            <div class="duration-value">
                                                                <input type="number"
                                                                       min="0"
                                                                       (change)="updateEstimatedFinish('days')"
                                                                       [(ngModel)]="model.durationParts.days" name="durationDays" id="durationDays">
                                                                <label for="durationDays">Days</label>
                                                            </div>
                                                            <div  class="duration-value">
                                                                <input type="number"
                                                                       min="0"
                                                                       (change)="updateEstimatedFinish('hours')"
                                                                       [(ngModel)]="model.durationParts.hours" name="durationHours" id="durationHours">
                                                                <label for="durationHours">Hours</label>
                                                            </div>
                                                            <div  class="duration-value">
                                                                <input type="number"
                                                                       min="0"
                                                                       (change)="updateEstimatedFinish('minutes')"
                                                                       [(ngModel)]="model.durationParts.minutes" name="durationMinutes" id="durationMinutes">
                                                                <label for="durationMinutes">Minutes</label>
                                                            </div>
                                                            <label data-toggle="popover"
                                                                   data-trigger="hover"
                                                                   data-content="Click to toggle the lock. When locked, changes to the Estimated Start/Finish will preserve the Duration">
                                                                <i class="fa fa-fw  lock-state"
                                                                   [ngClass]="model.locked ? 'fa-lock' : 'fa-unlock'"
                                                                   (click)="onLockChange()">
                                                                </i>
                                                            </label>
                                                        </div>
                                                    </td>
                                                    <td class="label U" nowrap="nowrap">
                                                        <label><span>Note</span></label>
                                                    </td>
	                                                <td class="valueNW" colspan="4">
                                                        <textarea name="note" id="note" rows="3" [(ngModel)]="model.note"></textarea>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </td>
                            </tr>
                            <tr class="no-grow-container"  *ngIf="!collapsedTaskDetail">
                                <td class="dates-info-container" colspan="2">
                                    <table class="dates-info">
                                        <tbody>
                                            <tr>
                                                <td class="date-created">Created by {{taskDetailModel.detail?.personCreateObj}} at {{taskDetailModel.detail?.assetComment?.dateCreated | date:dateFormatTime}}
                                                    {{(taskDetailModel.detail?.taskSpecId)? ' with spec id ' + taskDetailModel.detail?.taskSpecId: ''}}
                                                    <span *ngIf="taskDetailModel.detail?.recipe && hasCookbookPermission"> in recipe <a href="./../cookbook/index#/recipes/{{taskDetailModel.detail?.recipe?.id}}/gentasks/start"> {{taskDetailModel.detail?.recipe?.name}}</a></span>
                                                <td class="last-updated">Last updated: {{taskDetailModel.detail?.assetComment?.lastUpdated | date:dateFormatTime}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                            <tr class="deps no-grow-container">
                                <table>
                                    <tr>
                                        <td valign="top">
                                            <kendo-grid
                                                    *ngIf="dataGridTaskPredecessorsHelper"
                                                    class="successor-predecessor-table"
                                                    [data]="dataGridTaskPredecessorsHelper.gridData"
                                                    [sort]="dataGridTaskPredecessorsHelper.state.sort"
                                                    [sortable]="{mode:'single'}"
                                                    [resizable]="false"
                                                    (sortChange)="dataGridTaskPredecessorsHelper.sortChange($event)">
                                                    <!-- Toolbar Template -->
                                                    <ng-template kendoGridToolbarTemplate [position]="'top'">
                                                        <label class="pad-top-2 pad-left-10 mar-bottom-0">Predecessor ({{dataGridTaskPredecessorsHelper.gridData.data.length}})</label>
                                                        <button (click)="onAddPredecessor()" class="btn btn-add-new-dependency btn-default float-right mar-right-15 pad-top-2" type="button">
                                                            <i class="fa fa-med fa-fw fa-plus-circle"></i> <span>Add</span>
                                                        </button>
                                                    </ng-template>
                                                    <!-- Columns -->
                                                    <kendo-grid-column *ngFor="let column of predecessorSuccesorColumns"
                                                                       field="{{column.property}}"
                                                                       [width]="!column.width ? COLUMN_MIN_WIDTH : column.width">
                                                        <!-- Header Template -->
                                                        <ng-template kendoGridHeaderTemplate>
                                                            <label>{{column.label}}</label>
                                                        </ng-template>

                                                        <ng-template kendoGridCellTemplate *ngIf="column.property === 'desc'" let-dataItem let-rowIndex="rowIndex">
                                                            <!--<label class="pointer pad-left-7" (click)="openTaskDetail(dataItem, modalType.VIEW)">{{dataItem.desc}}</label>-->
                                                            <tds-combobox
                                                                    [(model)]="dataItem.model"
                                                                    [(metaParam)]="dataItem.id"
                                                                    [serviceRequest]="getTasksForComboBox"
                                                                    (selectionChange)="onPredecessorChange($event, dataItem, rowIndex)">
                                                            </tds-combobox>
                                                        </ng-template>
                                                    </kendo-grid-column>
                                                <kendo-grid-messages noRecords="There are no records to display."> </kendo-grid-messages>
                                            </kendo-grid>
                                        </td>
                                        <td valign="top">
                                            <kendo-grid
                                                    *ngIf="dataGridTaskSuccessorsHelper"
                                                    class="successor-predecessor-table"
                                                    [data]="dataGridTaskSuccessorsHelper.gridData"
                                                    [sort]="dataGridTaskSuccessorsHelper.state.sort"
                                                    [sortable]="{mode:'single'}"
                                                    [resizable]="false"
                                                    (sortChange)="dataGridTaskSuccessorsHelper.sortChange($event)">
                                                <!-- Toolbar Template -->
                                                <ng-template kendoGridToolbarTemplate [position]="'top'">
                                                    <label class="pad-top-2 pad-left-10 mar-bottom-0">Successors ({{dataGridTaskSuccessorsHelper.gridData.data.length}})</label>
                                                    <button (click)="onAddSuccessor()" class="btn btn-add-new-dependency btn-default float-right mar-right-15 pad-top-2" type="button">
                                                        <i class="fa fa-med fa-fw fa-plus-circle"></i> <span>Add</span>
                                                    </button>
                                                </ng-template>
                                                <!-- Columns -->
                                                <kendo-grid-column *ngFor="let column of predecessorSuccesorColumns"
                                                                   field="{{column.property}}"
                                                                   [width]="!column.width ? COLUMN_MIN_WIDTH : column.width">
                                                    <!-- Header Template -->
                                                    <ng-template kendoGridHeaderTemplate>
                                                        <label>{{column.label}}</label>
                                                    </ng-template>

                                                    <ng-template kendoGridCellTemplate *ngIf="column.property === 'desc'" let-dataItem let-rowIndex="rowIndex">
                                                        <!--<label class="pointer pad-left-7" (click)="openTaskDetail(dataItem, modalType.VIEW)">{{dataItem.desc}}</label>-->
                                                        <tds-combobox
                                                                [(model)]="dataItem.model"
                                                                [(metaParam)]="dataItem.id"
                                                                [serviceRequest]="getTasksForComboBox"
                                                                (selectionChange)="onSuccessorChange($event, dataItem, rowIndex)">
                                                        </tds-combobox>
                                                    </ng-template>
                                                </kendo-grid-column>
                                                <kendo-grid-messages noRecords="There are no records to display."> </kendo-grid-messages>
                                            </kendo-grid>
                                         </td>
                                    </tr>
                                </table>
                            </tr>
                            <tr class="deps grow-container">
                                <td colspan="5">
                                    <kendo-grid
                                        *ngIf="dataGridTaskNotesHelper"
                                        class="successor-predecessor-table"
                                        [data]="dataGridTaskNotesHelper.gridData"
                                        [sort]="dataGridTaskNotesHelper.state.sort"
                                        [sortable]="{mode:'single'}"
                                        [resizable]="false"
                                        (sortChange)="dataGridTaskNotesHelper.sortChange($event)">
                                    <!-- Toolbar Template -->
                                    <ng-template kendoGridToolbarTemplate [position]="'top'">
                                        <label class="pad-top-2 pad-left-10 mar-bottom-0">Task Notes ({{dataGridTaskNotesHelper.gridData.data.length}})</label>
                                    </ng-template>
                                    <!-- Columns -->
                                    <kendo-grid-column *ngFor="let column of taskNotesColumnsModel.columns"
                                                       field="{{column.property}}"
                                                       [width]="!column.width ? COLUMN_MIN_WIDTH : column.width">
                                        <!-- Header Template -->
                                        <ng-template kendoGridHeaderTemplate>
                                            <label>{{column.label}}</label>
                                        </ng-template>

                                        <ng-template kendoGridCellTemplate let-dataItem let-rowIndex="rowIndex" >
                                            <div class="pad-left-7 pad-bot-6">{{dataItem[column.property]}}</div>
                                        </ng-template>

                                    </kendo-grid-column>
                                    <kendo-grid-messages noRecords="There are no records to display."> </kendo-grid-messages>
                                </kendo-grid>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>
            <div class="modal-footer form-group-center">
	            <button class="btn btn-primary pull-left"
	                    (click)="updateTask()" type="button">
		            <span  class="fa fa-fw fa-floppy-o"></span>
		            <span>Update</span>
	            </button>
                <button (click)="cancelCloseDialog()" type="button" class="btn btn-default component-action-cancel pull-right">
                    <span class="glyphicon glyphicon-ban-circle"></span>
                    <span>Cancel</span>
                </button>
                <button (click)="deleteTask()" type="button" class="btn btn-danger component-action-delete">
                    <span  class="glyphicon glyphicon-trash"></span>
                    <span>Delete</span>
                </button>
            </div>
        </div>
    </div>
</div>
