<div class="import-batch-record-fields-component fields-container row" *ngIf="fieldsInfo">

    <!-- Fields Info Popup -->
    <kendo-popup #infoPopup *ngIf="popup.show"
                 [margin]="popup.margin"
                 [popupClass]="'content popup'"
                 [offset]="popup.offset"
                 [positionMode]="popup.position">
        <div style="border: 1px solid #656565;">
            <div style="padding-top: 5px;padding-right: 3px;background-color: #5f9fcf;display:  inline-block;padding-left: 10px;width:  100%;">
                <label style="float: left;display: inline;padding-right: 0;color: #ffffff;">
                    {{popup.title}}
                </label>
                <i style="float: right;cursor: pointer;font-size: smaller;color: #ffffff;display: inline;margin-top: 5px;margin-right:  5px;"
                   class="glyphicon glyphicon-remove" (click)="popup.show=false"></i>
            </div>
            <div style="padding: 5px 15px 15px 15px;">

                <!-- Find Type-->
                <div *ngIf="popup.type === FieldInfoType.FIND">
                    <kendo-grid
                                style="width: 400px;" [style.maxHeight.px]="200"
                                [data]="popupGridData"
                                [groupable]="false" [group]="popupGridGroups">
                        <kendo-grid-column [title]="'Domain'" field="domainIndex" [width]="1">
                            <ng-template kendoGridGroupHeaderTemplate let-field="field" let-value="value" let-group="group">
                                <span style="width: 50%">Domain: {{group.items[0].domainName}}</span>
                                <span *ngIf="group.items[0].recordsFound">Records Found: {{group.items[0].recordsFound}}</span>
                            </ng-template>
                        </kendo-grid-column>
                        <kendo-grid-column [title]="'Field Name'" field="fieldName"></kendo-grid-column>
                        <kendo-grid-column [title]="'Value'" field="value"></kendo-grid-column>
                    </kendo-grid>
                    <div style="margin-top: 5px;">
                        <label style="font-size: 13px;">Results:</label>
                        <span *ngIf="popup.results">
                            <span *ngFor="let id of popup.results" class="badge" style="margin-right: 2px;">{{id}}</span>
                        </span>
                        <span *ngIf="!popup.results"><i>No results found</i></span>
                    </div>
                </div>

                <!-- Create/Update Type-->
                <div *ngIf="popup.type === FieldInfoType.CREATE || popup.type === FieldInfoType.UPDATE">
                    <div>
                        <label style="font-size: 13px;">Domain: {{popup.domain}}</label>
                    </div>
                    <kendo-grid style="width: 300px;" [style.maxHeight.px]="200"
                                [data]="popupGridData">
                        <kendo-grid-column [title]="'Field Name'" field="fieldName"></kendo-grid-column>
                        <kendo-grid-column [title]="'Value'" field="value"></kendo-grid-column>
                    </kendo-grid>
                </div>

            </div>
        </div>
    </kendo-popup>

    <kendo-grid
            [data]="gridData"
            [pageSize]="25">
        <ng-template kendoGridToolbarTemplate [position]="'top'">
            <label class="fieldsFilterLabel col-sm-1 text-left">Fields</label>
            <div class="fieldsFilter col-sm-2">
                <kendo-dropdownlist id="fieldsFilter" name="fieldsFilter"
                    [data]="fieldsFilter.options"
                    [textField]="'text'"
                    [valueField]="'value'"
                    [(ngModel)]="fieldsFilter.selected"
                    (valueChange)="onFieldsFilter($event)"
                    placeholder="Filter"
                    class="form-control input-sm">
                </kendo-dropdownlist>
            </div>
            <div class="fieldsFilterText col-sm-3">
                <input [(ngModel)]="fieldsFilter.nameFilter.value"
                       type="text" class="form-control"
                       name="fieldsFilterText" placeholder="Filter on field name"
                       (keyup)="onTextFilter()">
                <span *ngIf="fieldsFilter.nameFilter.value"
                      class="fa fa-times form-control-feedback"
                      (click)="clearTextFilter()"></span>
            </div>
        </ng-template>
        <kendo-grid-column title="Name" field="name" [width]="100"></kendo-grid-column>

        <!-- Current / Previous Column Label -->
        <kendo-grid-column [width]="200"
            [title]="currentPreviousColumnLabel"
            field="currentPreviousValue"
            [class]="batchRecord.operation === BATCH_RECORD_OPERATION.UPDATE ? '' : 'gray-background'"
        >
        </kendo-grid-column>

        <!-- Imported Value Column Label -->
        <kendo-grid-column [width]="200" title="Imported Value" [class]="'import-value'">
            <ng-template kendoGridCellTemplate let-dataItem>
                <div class="import-item-container">
                    <div *ngIf="dataItem.currentValueAction === CurrentValueAction.ShowValue"
                        [style.font-weight]="dataItem.modified === true ? 'bold' : 'normal'">
                        {{dataItem.importValue}}
                    </div>
                    <div *ngIf="dataItem.currentValueAction === CurrentValueAction.ShowInit" class="has-init-value">
                        {{dataItem.initValue}}
                    </div>
                    <input *ngIf="dataItem.currentValueAction === CurrentValueAction.EditValue"
                        type="text"
                        class="import-value-input form-control"
                        [(ngModel)]="dataItem.importValue"
                        [style.font-weight]="dataItem.currentPreviousValue !== dataItem.importValue &&  batchRecord.operation === BATCH_RECORD_OPERATION.UPDATE? 'bold' : 'normal'"
                    />
                    <input *ngIf="dataItem.currentValueAction === CurrentValueAction.EditInit"
                        type="text"
                        class="has-init-value import-value-input form-control"
                        [(ngModel)]="dataItem.initValue"
                    />
                    <span *ngIf="(dataItem.currentValueAction === CurrentValueAction.ShowInit || dataItem.currentValueAction === CurrentValueAction.EditInit)">
                        <i [title]="MESSAGE_FIELD_WILL_BE_INITIALIZED" class="fa fa-w fa-info has-init-value"></i>
                    </span>
                </div>
            </ng-template>
        </kendo-grid-column>
        <kendo-grid-column title="Reference" [width]="80">
            <ng-template kendoGridCellTemplate let-dataItem>
                <i *ngIf="dataItem.create" (click)="onShowPopup($event, FieldInfoType.CREATE, dataItem)" title="View Create Reference Detail" class="fa fa-plus-square" style="cursor: pointer; font-size: 17px; margin-right: 5px;"></i>
                <i *ngIf="dataItem.update" (click)="onShowPopup($event, FieldInfoType.UPDATE, dataItem)" title="View Update Reference Detail" class="fa fa-pencil-square" style="cursor: pointer; font-size: 17px; margin-right: 5px;"></i>
                <i *ngIf="dataItem.find && dataItem.find.query.length > 0" (click)="onShowPopup($event, FieldInfoType.FIND, dataItem)" title="View Find Results" class="fa fa-search" style="cursor: pointer; font-size: 17px; margin-right: 5px;"></i>
            </ng-template>
        </kendo-grid-column>

        <!-- Errors Column -->
        <kendo-grid-column title="Error(s)">
            <ng-template kendoGridCellTemplate let-dataItem >
                <div *ngFor="let error of dataItem.errors" class="error">
                    * {{error}}
                </div>
            </ng-template>
        </kendo-grid-column>
    </kendo-grid>

    <div class="row footer">
        <tds-check-action
                *ngIf="showActionButtons()"
                [disabled]="!areOverrideValuesDirty()"
                [name]="'Save'"
                (onClick)="onUpdate()"
                [noneStateIcon]="'glyphicon glyphicon-floppy-disk'"
                [class]="'btn-sm col-sm-1'"
                [(model)]="saveStatus">
        </tds-check-action>
        <tds-check-action
                *ngIf="showActionButtons()"
                [disabled]="areOverrideValuesDirty()"
                [name]="'Process'"
                (onClick)="onProcess()"
                [noneStateIcon]="'glyphicon glyphicon-retweet'"
                [class]="'btn-sm col-sm-1'"
                [(model)]="processStatus">
        </tds-check-action>
        <button *ngIf="showIncludeButton()"
                (click)="onInclude()"
                class="btn btn-default btn-sm col-sm-1" type="button">
            <i class="glyphicon glyphicon-plus"></i>
            Include
        </button>
        <button *ngIf="showIgnoreButton()"
                (click)="onIgnore()"
                class="btn btn-default btn-sm col-sm-1" type="button">
            <i class="glyphicon glyphicon-eye-close"></i>
            Ignore
        </button>
        <button (click)="onCancel()"
                class="btn btn-default btn-sm col-sm-1 pull-right" type="button">
            <i class="glyphicon glyphicon-remove-circle"></i>
            <span>{{showActionButtons() ? 'Cancel' : 'Close'}}</span>
        </button>
    </div>
</div>